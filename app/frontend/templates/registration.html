<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–°–ï –ü–†–û–§–ò "–í–¢"</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <style>
        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1 class="title">–û–û–û –í–°–ï –ü–†–û–§–ò "–í–ü"üë∑üèª</h1>
    </div>

    <div class="form-container">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="registration-form" method="post" action="https://all-professionls.ru/registration">
            <div class="form-group">
                <label for="name">–ò–º—è:</label>
                <input type="text" id="name" name="name" required>
                <div class="error-message" id="name-error"></div>
            </div>
            <div class="form-group">
                <label for="last_name">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="last_name" name="last_name" required>
                <div class="error-message" id="last_name-error"></div>
            </div>
            <div class="form-group">
                <label for="surname">–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                <input type="text" id="surname" name="surname" required>
                <div class="error-message" id="surname-error"></div>
            </div>
            <div class="form-group">
                <label for="number">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="number" name="number" required>
                <div class="error-message" id="number-error"></div>
            </div>
            <div class="form-group">
                <label for="city">–ì–æ—Ä–æ–¥:</label>
                <select id="city" name="city" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    {% for i in city %}
                        <option value="{{ i.id }}">{{ i.title }}</option>
                    {% endfor %}
                </select>
                <div class="error-message" id="city-error"></div>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
                <div class="error-message" id="email-error"></div>
            </div>
            <div class="form-group">
                <label for="id_prof">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</label>
                <select id="id_prof" name="id_prof" multiple size="30" required>

                    {% for j in prof %}
                        <option value="{{ j.id }}">{{ j.title }}</option>
                    {% endfor %}
                </select>
                <div class="error-message" id="id_prof-error"></div>
            </div>
            <div class="form-group">
                <label for="qualification">–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è (–†–∞–∑—Ä—è–¥):</label>
                <input type="text" id="qualification" name="qualification" required>
                <div class="error-message" id="qualification-error"></div>
            </div>
            <div class="form-group">
                <label for="experience">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</label>
                <input type="text" id="experience" name="experience" required>
                <div class="error-message" id="experience-error"></div>
            </div>
            <div class="form-group">
                <label for="ready_business_trip">–ì–æ—Ç–æ–≤—ã –ª–∏ –≤—ã –∫ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞–º?</label>
                <input type="checkbox" id="ready_business_trip" value="true" name="ready_business_trip">
                <div class="error-message" id="ready_business_trip-error"></div>
            </div>
            <div class="form-group">
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </form>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#id_prof').select2({
                placeholder: "–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å", // –î–æ–±–∞–≤–ª—è–µ–º placeholder
                allowClear: true  // –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—á–∏—â–∞—Ç—å –≤—ã–±–æ—Ä
            });
        });
    </script>
    <script>
    document.getElementById('registration-form').addEventListener('submit', async function(event) {
        event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã

        const formData = new FormData(this);
        const response = await fetch(this.action, {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const data = await response.json();

            // –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–æ–≤—ã–µ –æ—à–∏–±–∫–∏
            data.detail.forEach(error => {
                const field = error.loc[1];
                const message = error.msg;
                const errorElement = document.getElementById(`${field}-error`);

                if (errorElement) {
                    errorElement.textContent = message;
                }
            });
        } else {
            // –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
            alert('–§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
            this.reset(); // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        }
    });
    </script>
</body>
</html>